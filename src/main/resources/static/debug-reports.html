<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>调试报表功能</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container mt-4">
        <h2>调试报表功能</h2>
        
        <div class="row mb-3">
            <div class="col-12">
                <button class="btn btn-primary me-2" onclick="testJSLoad()">测试JS加载</button>
                <button class="btn btn-secondary me-2" onclick="testReportApp()">测试ReportApp</button>
                <button class="btn btn-success me-2" onclick="testDashboard()">测试概览页面</button>
                <button class="btn btn-info me-2" onclick="testTemplates()">测试模板页面</button>
            </div>
        </div>
        
        <div id="debug-output" class="mt-4">
            <div class="alert alert-info">点击按钮开始测试...</div>
        </div>
        
        <!-- 模拟报表内容区域 -->
        <div id="content-area" class="mt-4 border p-3">
            <p>内容区域 - 等待加载...</p>
        </div>
        
        <div id="page-title" style="display: none;">调试页面</div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/reports-fixed.js"></script>
    
    <script>
        function testJSLoad() {
            const output = document.getElementById('debug-output');
            try {
                if (typeof AdvancedReportApp !== 'undefined') {
                    output.innerHTML = '<div class="alert alert-success">✓ AdvancedReportApp 类已加载</div>';
                } else {
                    output.innerHTML = '<div class="alert alert-danger">✗ AdvancedReportApp 类未加载</div>';
                }
            } catch (e) {
                output.innerHTML = `<div class="alert alert-danger">✗ 错误: ${e.message}</div>`;
            }
        }
        
        function testReportApp() {
            const output = document.getElementById('debug-output');
            try {
                if (typeof reportApp !== 'undefined' && reportApp) {
                    output.innerHTML = '<div class="alert alert-success">✓ reportApp 实例已创建</div>';
                } else {
                    output.innerHTML = '<div class="alert alert-warning">⚠ reportApp 实例未创建，尝试手动创建...</div>';
                    // 手动创建实例
                    window.reportApp = new AdvancedReportApp();
                    setTimeout(() => {
                        if (window.reportApp) {
                            output.innerHTML += '<div class="alert alert-success">✓ reportApp 手动创建成功</div>';
                        }
                    }, 100);
                }
            } catch (e) {
                output.innerHTML = `<div class="alert alert-danger">✗ 错误: ${e.message}</div>`;
            }
        }
        
        function testDashboard() {
            const output = document.getElementById('debug-output');
            try {
                if (window.reportApp && typeof window.reportApp.showDashboard === 'function') {
                    window.reportApp.showDashboard();
                    output.innerHTML = '<div class="alert alert-success">✓ 概览页面加载成功</div>';
                } else {
                    output.innerHTML = '<div class="alert alert-danger">✗ showDashboard 方法不可用</div>';
                }
            } catch (e) {
                output.innerHTML = `<div class="alert alert-danger">✗ 错误: ${e.message}</div>`;
            }
        }
        
        function testTemplates() {
            const output = document.getElementById('debug-output');
            try {
                if (window.reportApp && typeof window.reportApp.showReportTemplates === 'function') {
                    window.reportApp.showReportTemplates();
                    output.innerHTML = '<div class="alert alert-success">✓ 模板页面加载成功</div>';
                } else {
                    output.innerHTML = '<div class="alert alert-danger">✗ showReportTemplates 方法不可用</div>';
                }
            } catch (e) {
                output.innerHTML = `<div class="alert alert-danger">✗ 错误: ${e.message}</div>`;
            }
        }
        
        // 页面加载完成后的检查
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                const output = document.getElementById('debug-output');
                let status = '<div class="alert alert-info"><h5>自动检查结果:</h5>';
                
                // 检查类是否存在
                if (typeof AdvancedReportApp !== 'undefined') {
                    status += '<p>✓ AdvancedReportApp 类已加载</p>';
                } else {
                    status += '<p>✗ AdvancedReportApp 类未加载</p>';
                }
                
                // 检查实例是否存在
                if (typeof reportApp !== 'undefined' && reportApp) {
                    status += '<p>✓ reportApp 实例已创建</p>';
                } else {
                    status += '<p>✗ reportApp 实例未创建</p>';
                }
                
                // 检查全局函数
                const globalFunctions = ['showDashboard', 'showStandardReports', 'showTrendAnalysis', 'showCustomReports', 'showReportTemplates', 'showReportHistory'];
                globalFunctions.forEach(func => {
                    if (typeof window[func] === 'function') {
                        status += `<p>✓ ${func} 全局函数已定义</p>`;
                    } else {
                        status += `<p>✗ ${func} 全局函数未定义</p>`;
                    }
                });
                
                status += '</div>';
                output.innerHTML = status;
            }, 500);
        });
    </script>
</body>
</html>